{"version":3,"sources":["src/react-dom/dom.js","src/react-dom/diff.js","src/react/component.js","src/react/create-element.js","src/react/index.js","src/react-dom/render.js","src/react-dom/index.js","src/index.js"],"names":["setAttribute","dom","name","value","test","toLowerCase","vaule","style","cssText","key","hasOwnPrototype","removeAttribute","diff","vnode","container","newDOM","diffNode","parentNode","appendChild","outer","nodeType","textContent","document","createTextNode","replaceChild","tag","diffComponent","isSameNodeType","createElement","childNodes","map","perentNode","children","length","diffChildren","diffAttributes","vchildren","keyed","domChildren","Array","from","child","push","min","childrenLen","i","vchild","undefined","j","_child","f","nextSibling","removeNode","insertBefore","oldDOM","comp","_component","constructor","setComponentProps","attrs","base","unmountComponent","createComponent","old","attributes","attr","component","props","componentWillMount","componentWillReceiveProps","renderComponent","renderor","render","componentWillUpdate","componentDidUpdate","componentDidMount","newComponent","prototype","Component","componentWillUnmount","nodeName","removeChild","state","stateChange","Object","assign","Counter","num","console","log","setState","onClick","React","ReactDOM","querySelector"],"mappings":"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","file":"src.a2b27638.map","sourceRoot":"..","sourcesContent":["function setAttribute(dom, name, value = '') {\n    if (name === 'className') name = 'class'\n\n    if (/on\\w+/.test(name)) {\n        name = name.toLowerCase()\n        dom[name] = value\n    } else if (name === 'style') {\n        if (!vaule || typeof value === 'string') {\n            dom.style.cssText = value\n        } else if (value && typeof value === 'object') {\n            for (let key in value) {\n                dom.style[key] = typeof value[key] === 'number' ? `${value[key]}px` : value[key]\n            }\n        }\n    } else {\n        if (dom.hasOwnPrototype(name)) {\n            dom[name] = value\n        }\n        if (value) {\n            dom.setAttribute(name, value)\n        } else {\n            dom.removeAttribute(name)\n        }\n    }\n}\n\nexport default setAttribute\n","import setAttribute from './dom'\nimport { Component } from '../react'\n\n/**\n *@param {HTMLElement} dom 真实DOM\n *@param {vnode} vnode 虚拟DOM\n *@param {HTMLElement} container 容器\n *@return {HTMLElement} 更新后的DOM\n */\nfunction diff(dom, vnode, container) {\n    const newDOM = diffNode(dom, vnode);\n\n    if (container && newDOM.parentNode !== container) {\n        container.appendChild(newDOM);\n    }\n    return newDOM;\n}\n\nfunction diffNode(dom, vnode) {\n    let outer = dom;\n\n    // 异常情况:undefined、null、boolean类型\n    if (!vnode) vnode = ''\n    // 比较数值或者字符串\n    if (typeof vnode === 'string' || typeof vnode === 'number') {\n        // 当前就是文本节点,直接替换\n        if (dom && dom.nodeType === 3) {\n            if (dom.textContent !== vnode ) {\n                dom.textContent = vnode\n            }\n        } else { // 当前不是文本节点, 新建文本节点替换原来节点\n            outer = document.createTextNode(vnode)\n            if (dom && dom.parentNode) {\n                dom.parentNode.replaceChild(outer, dom)\n            }\n        }\n\n        return outer\n    }\n    // 比较组件\n    if (typeof vnode.tag === 'function') {\n        return diffComponent(dom, vnode)\n    }\n    // 比较正常DOM\n    if (!dom || !isSameNodeType(dom, vnode)) {\n        outer = document.createElement(vnode.tag)\n\n        if (dom) {\n            // 将原来的子节点移到新节点下\n            [...dom.childNodes].map(outer.appendChild)\n            // 移除掉原来的DOM对象\n            if (dom.perentNode) {\n                dom.parentNode.replaceChild(outer, dom)\n            }\n        }\n    }\n    // 比较子节点\n    if ((vnode.children && vnode.children.length) || (outer.childNodes && outer.childNodes.length)) {\n        diffChildren(outer, vnode.children)\n    }\n    // 比较属性\n    diffAttributes(outer, vnode)\n\n    return outer\n}\n\nfunction diffChildren(dom, vchildren) {\n    const keyed = {}\n    const children = []\n    const domChildren = Array.from(dom.childNodes)\n\n    // 把带key和不带key的分开\n    if (domChildren.length) {\n        for (let child of domChildren) {\n            const key = child.key\n            if (key) {\n                keyed[key] = child\n            } else {\n                children.push(child)\n            }\n        }\n    }\n\n    if (vchildren && vchildren.length) {\n        let min = 0;\n        let childrenLen = children.length\n\n        for (let i=0; i < vchildren.length; i++) {\n            let child;\n            const vchild = vchildren[i]\n            const key = vchild.key\n\n            if (key && keyed[key]) {\n                child = keyed[key]\n                keyed[key] = undefined\n            } else if (min < childrenLen) {\n                for (let j = min; j < childrenLen; j++) {\n                    let _child = children[j]\n\n                    if (_child && isSameNodeType(_child, vchild)) {\n                        child = _child\n                        children[j] = undefined\n\n                        if (j === childrenLen-1) childrenLen--\n                        if (j === min) min++;\n                        break;\n                    }\n                }\n            }\n            child = diffNode(child, vchild)\n\n            const f = domChildren[i];\n            if (child && child !== dom && child !==f) {\n                if (!f) { // 新增节点\n                    dom.appendChild(child)\n                } else if (child === f.nextSibling) { // 移除节点\n                    removeNode(f)\n                } else { // 插入节点\n                    dom.insertBefore(child, f)\n                }\n            }\n        }\n    }\n}\n\nfunction diffComponent(dom, vnode) {\n    let oldDOM = dom\n    let comp = dom && dom._component\n\n    // 组件类型没有变化,重置属性\n    if (comp && comp.constructor === vnode.tag) {\n        setComponentProps(comp, vnode.attrs)\n        dom = comp.base\n    } else { // 组件类型变化,移除旧组件渲染新组件\n        if (comp) {\n            unmountComponent(comp)\n            oldDOM = null\n        }\n        comp = createComponent(vnode.tag, vnode.attrs)\n        setComponentProps(comp, vnode.attrs)\n        dom = comp.base\n\n        if (oldDOM && dom !== oldDOM) {\n            oldDOM._component = null\n            removeNode(oldDOM);\n        }\n    }\n\n    return dom\n}\n\nfunction diffAttributes(dom, vnode) {\n    const old = {}\n    const attrs = vnode.attrs\n\n    for (let attr of Array.from(dom.attributes)) {\n        old[attr.name] = attr.value\n    }\n\n    // 新属性中没有老属性, 移除之\n    for (let name in old) {\n        if (!(name in attrs)) {\n            setAttribute(dom, name, undefined)\n        }\n    }\n    // 更新新属性值\n    for (let name in attrs) {\n        if (old[name] !== attrs[name]) {\n            setAttribute(dom, name, attrs[name])\n        }\n    }\n}\n\n// 设置组件属性\nfunction setComponentProps(component, props) {\n    if (!component.base && component.componentWillMount) {\n        component.componentWillMount()\n    } else if (component.componentWillReceiveProps) {\n        component.componentWillReceiveProps(props)\n    }\n\n    component.props = props\n\n    renderComponent(component)\n}\n\n// 更新组件\nfunction renderComponent(component) {\n    const renderor = component.render()\n\n    if (component.base && component.componentWillUpdate) {\n        component.componentWillUpdate()\n    }\n    let base = diffNode(component.base, renderor)\n\n    component.base = base\n    base._component = component\n    if (component.base && component.componentDidUpdate) {\n        component.componentDidUpdate()\n    } else if (component.componentDidMount) {\n        component.componentDidMount()\n    }\n}\n\n// 创建组件\nfunction createComponent(component, props) {\n    let newComponent\n\n    if ('render' in component.prototype) {\n        newComponent = new component(props)\n    } else {\n        newComponent = new Component(props)\n        newComponent.constructor = component\n        newComponent.render = function() {\n            return this.constructor(props)\n        }\n    }\n\n    return newComponent\n}\n\n// 卸载组件\nfunction unmountComponent( component ) {\n    if ( component.componentWillUnmount ) component.componentWillUnmount();\n    removeNode( component.base);\n}\n\n// 类型判断封装\nfunction isSameNodeType(dom, vnode) {\n    if (typeof vnode === 'string' || typeof vnode === 'number') {\n        return dom.nodeType === 3\n    }\n    if (typeof vnode.tag === 'string') {\n        return dom.nodeName.toLowerCase() === vnode.tag.toLowerCase()\n    }\n\n    return dom && dom._component && dom._component.constructor === vnode.tag\n}\n\n// 移除Node封装\nfunction removeNode(dom) {\n    if (dom && dom.parentNode) {\n        dom.parentNode.removeChild(dom);\n    }\n}\n\nexport {\n    diff,\n    renderComponent\n};\n\n","import { renderComponent } from '../react-dom/diff'\n\nclass Component {\n    constructor(props = {}) {\n        this.state = {}\n        this.props = props\n    }\n\n    setState(stateChange) {\n        Object.assign(this.state, stateChange)\n        renderComponent(this)\n    }\n}\n\nexport default Component\n","const createElement = function(tag, attrs, ...children) {\n    attrs = attrs || {}\n    return {\n        tag,\n        attrs,\n        key: attrs.key,\n        children\n    }\n}\n\nexport default createElement\n","import Component from './component'\nimport createElement from './create-element'\n\nexport default {\n    Component,\n    createElement,\n}\n","import { diff } from './diff'\n\nfunction render(vnode, container, dom) {\n    return diff(dom, vnode, container)\n}\n\nexport default render;\n","import render from './render'\n\nexport default {\n    render\n}\n","import React from './react'\nimport ReactDOM from './react-dom'\n\nclass Counter extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = { num: 1 }\n    }\n\n    componentWillUpdate() {\n        console.log('update execute')\n    }\n\n    componentWillMount() {\n        console.log('mount execute')\n    }\n\n    onClick() {\n        this.setState({ num: this.state.num + 1 })\n    }\n\n    render() {\n        return (\n            <div>\n                <h1>count: {this.state.num}</h1>\n                <button onClick={() => this.onClick()}> add </button>\n            </div>\n        )\n    }\n}\n\nReactDOM.render(<Counter />, document.querySelector('#app'))\n"]}